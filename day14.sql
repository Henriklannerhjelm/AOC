CREATE TABLE #HL_TEMP(ID INT IDENTITY(1, 1),VAL  INT,CMD  VARCHAR(4),INST VARCHAR(100),GRP INT)
INSERT INTO #HL_TEMP (CMD,VAL,INST) VALUES  ('MASK',0,'X100110110X011000101000101XX11001X11'),('MEM',5201,'1838761'),('MEM',32099,'25747352'),('MEM',36565,'72187'),('MEM',31494,'369864'),('MEM',17260,'3138'),('MEM',64903,'91484814'),('MASK',0,'0X00100101000XX0011110X10110X100X010'),('MEM',54866,'120526'),('MEM',57614,'430839'),('MEM',17916,'648'),('MEM',43192,'325890'),('MEM',23626,'313518443'),('MEM',45988,'50484'),('MASK',0,'01001001X0001X00XXX110X010010XX0X001'),('MEM',60805,'1352'),('MEM',37516,'5942314'),('MEM',63169,'237020309'),('MEM',31655,'274507'),('MASK',0,'010011010001110000010000X101X0X11X01'),('MEM',49875,'15349586'),('MEM',6956,'13765452'),('MEM',675,'886107857'),('MASK',0,'01000001X1XX11011X1111X111X000X01X11'),('MEM',2135,'5930'),('MEM',1861,'1009'),('MEM',62754,'145160'),('MEM',1333,'1153712'),('MEM',15455,'7454'),('MASK',0,'01X01X011X0011X0X10110001X1X1000X110'),('MEM',53253,'667716'),('MEM',47571,'745817'),('MEM',48582,'5810'),('MEM',3620,'7851685'),('MEM',41836,'14080244'),('MEM',39150,'84103'),('MASK',0,'01001X01100X100010X111111X11100XX111'),('MEM',249,'514'),('MEM',25687,'48545'),('MEM',62083,'208926'),('MEM',39872,'2590'),('MEM',28491,'267'),('MEM',25340,'115744'),('MEM',31101,'6781'),('MASK',0,'0100100100011101000XX001XX0010100X10'),('MEM',6053,'6291996'),('MEM',37941,'514441'),('MEM',22984,'108425255'),('MEM',30540,'127685'),('MASK',0,'000X100101011X1X1010X1011110XX10X1X0'),('MEM',42567,'253905'),('MEM',45241,'15790'),('MEM',57132,'480344'),('MEM',29971,'22597051'),('MASK',0,'XXX0111110001100010X1X01X10X0000000X'),('MEM',44680,'428361054'),('MEM',17571,'4884'),('MASK',0,'X1X001010X0111101X11X100X10100101100'),('MEM',55107,'2922'),('MEM',8605,'5742'),('MEM',63754,'289191'),('MASK',0,'01101001010X11000110111X11000X01X000'),('MEM',48186,'7310'),('MEM',30306,'413'),('MEM',1980,'538481'),('MASK',0,'010011011XX011X110011111101X01101X1X'),('MEM',45241,'11454771'),('MEM',65349,'36152803'),('MEM',62368,'34863'),('MEM',26794,'5220'),('MASK',0,'010X10XXX1001100011101X00X0110011110'),('MEM',15496,'898'),('MEM',59847,'32170699'),('MEM',5411,'130682'),('MEM',27017,'205172'),('MEM',48688,'3072'),('MASK',0,'001X000X111X110000110XX0010100001110'),('MEM',17575,'12630818'),('MEM',51454,'28544'),('MEM',52745,'45251'),('MASK',0,'000000010100X110X11101X101X1011010X1'),('MEM',49456,'637756'),('MEM',63169,'99927'),('MEM',50318,'7599616'),('MEM',42115,'48825'),('MEM',20469,'5931716'),('MEM',56899,'2884'),('MASK',0,'01XX100X0100X10001XX011111X000001XX0'),('MEM',45630,'2305'),('MEM',28560,'118602807'),('MEM',45644,'52185'),('MEM',3682,'56264'),('MEM',63201,'237495702'),('MEM',63572,'7683'),('MEM',24477,'370'),('MASK',0,'01X0X0XX0X011100011110000X0XX00X1111'),('MEM',14028,'3492'),('MEM',28452,'213847'),('MEM',57663,'203516'),('MEM',24701,'45071697'),('MEM',30226,'856135'),('MEM',59279,'100557'),('MASK',0,'0110100001X0X1X0010XX1XX00X100000000'),('MEM',4237,'60693'),('MEM',51454,'56389'),('MEM',44364,'12145'),('MEM',53190,'3825966'),('MASK',0,'0X0010000X011X0011111001100010X10100'),('MEM',45988,'84435'),('MEM',43613,'171165'),('MEM',39150,'2025'),('MASK',0,'000001010X111100111101001000X00X000X'),('MEM',7204,'243074994'),('MEM',30540,'2829011'),('MEM',16986,'171341'),('MASK',0,'01101X0101001X101X1111110X0X01X0010X'),('MEM',40006,'276307'),('MEM',50601,'45'),('MEM',2907,'7955'),('MEM',61049,'14014170'),('MEM',20722,'52156072'),('MEM',12299,'1701485'),('MEM',4643,'2041760'),('MASK',0,'X1101000010X110X0111X011001101000000'),('MEM',29309,'29638912'),('MEM',23626,'127552394'),('MEM',39357,'2743410'),('MASK',0,'XXX01000000110001111101X101X1XX0XX01'),('MEM',32322,'110798340'),('MEM',38758,'20398089'),('MEM',62368,'6402'),('MEM',12381,'125762'),('MEM',34042,'46630'),('MASK',0,'0X1X100X0X01100X11X11111101100100001'),('MEM',56680,'52806'),('MEM',3416,'5097254'),('MEM',21217,'959'),('MEM',11134,'22705'),('MEM',39515,'607'),('MEM',31858,'527794383'),('MASK',0,'011110010100X10001110111X0XXX00110X1'),('MEM',37752,'3783'),('MEM',27543,'180509'),('MEM',56503,'26998899'),('MEM',33984,'2996098'),('MEM',6471,'16602683'),('MEM',18585,'5056811'),('MEM',3477,'16274'),('MASK',0,'010110011XXX110X01011XX11X0100110X00'),('MEM',43993,'784'),('MEM',12295,'412860764'),('MEM',62707,'11253'),('MEM',27017,'1813664'),('MASK',0,'1XX0X001010X1010101100X000X0100XX000'),('MEM',25364,'640'),('MEM',35537,'489258314'),('MEM',356,'47335'),('MEM',46814,'130'),('MEM',21071,'32074'),('MEM',23980,'1969160'),('MEM',43457,'28765451'),('MASK',0,'0X0XX00110XX1X00X10111110011X01X1001'),('MEM',37516,'3409'),('MEM',32451,'486160'),('MEM',31704,'494261'),('MEM',64905,'489121330'),('MASK',0,'10001001X101111010X010X1X11X1001010X'),('MEM',19927,'125979'),('MEM',16164,'163616'),('MEM',41291,'11806544'),('MEM',13074,'22666'),('MEM',65160,'1102'),('MEM',21338,'53735104'),('MASK',0,'00X00101X10111XX111101XX10X111111100'),('MEM',44736,'13061'),('MEM',62844,'31422'),('MEM',4643,'59264'),('MEM',45417,'5454'),('MASK',0,'X0001X010X001101011X11001XX000101000'),('MEM',33984,'13200'),('MEM',15462,'316464'),('MEM',2638,'1434216'),('MEM',29044,'1370180'),('MEM',57663,'77699993'),('MEM',39191,'9595034'),('MASK',0,'100X1X0X010111X011101011111111XX1000'),('MEM',60509,'275540'),('MEM',65073,'8066'),('MEM',64726,'78129'),('MEM',15719,'724'),('MEM',52499,'43989105'),('MEM',57518,'6805488'),('MEM',27827,'1522993'),('MASK',0,'0X010110X011X100111X00000111X1110X10'),('MEM',395,'16602'),('MEM',21477,'62043769'),('MEM',24630,'663408947'),('MEM',3983,'31082032'),('MEM',30545,'456250'),('MASK',0,'0100XX01X000X10X10011101100X11101X10'),('MEM',28174,'110183887'),('MEM',9644,'12911'),('MEM',62113,'145'),('MASK',0,'010010X10000100100110000101X1XX11011'),('MEM',63016,'127052'),('MEM',49130,'37'),('MEM',25394,'187810'),('MEM',29779,'11708792'),('MEM',36144,'1033'),('MASK',0,'00101001X10XX10X11111X1100000111X001'),('MEM',35746,'498408'),('MEM',15462,'7839193'),('MEM',5741,'168870'),('MASK',0,'0010100100X011XX1111X1001001X1X10101'),('MEM',2256,'10474689'),('MEM',57428,'8228'),('MEM',34062,'16609889'),('MEM',45031,'106065'),('MEM',17162,'138367053'),('MEM',23302,'14262'),('MASK',0,'001100110X1X11XX110100X0010100XX1000'),('MEM',33186,'1012027'),('MEM',34051,'148436'),('MEM',4762,'25019364'),('MEM',41825,'102071658'),('MEM',32580,'739'),('MEM',15455,'151015'),('MASK',0,'01X1XX00X10001000100011001000000XX10'),('MEM',31330,'300785'),('MEM',30222,'206857068'),('MEM',27739,'774225'),('MEM',47798,'12155'),('MEM',57437,'440075165'),('MEM',49892,'58'),('MEM',44723,'116116'),('MASK',0,'100X1X00000X100011X1X00100101X00010X'),('MEM',35368,'5187'),('MEM',24769,'1425443'),('MEM',62844,'277'),('MEM',30729,'11517370'),('MASK',0,'0110100X0010110111X10X111000X11011X1'),('MEM',63295,'139'),('MEM',60805,'381899'),('MEM',6956,'3979616'),('MEM',12295,'1828'),('MASK',0,'010010X10X00X00X00X11XX00001X1001X00'),('MEM',39150,'459766'),('MEM',52621,'1962'),('MEM',11891,'5261559'),('MASK',0,'X11011X11X00110001011X1X110010000000'),('MEM',48473,'3539'),('MEM',13808,'331'),('MEM',30016,'676'),('MEM',9736,'3140258'),('MEM',12233,'388562584'),('MEM',42686,'1048145655'),('MEM',26132,'67723'),('MASK',0,'01001X0X010X0001001X10101111X10110X1'),('MEM',35042,'230878861'),('MEM',8611,'488144'),('MEM',4290,'942073'),('MEM',12381,'17121117'),('MEM',15011,'225'),('MEM',8378,'9255'),('MASK',0,'00001X0XX01X11X01101001101011110101X'),('MEM',49708,'312037855'),('MEM',19488,'93439469'),('MEM',57113,'7931'),('MEM',29037,'210754'),('MASK',0,'0100X001X0X01X0100110X11X110001110X1'),('MEM',8519,'38940'),('MEM',49033,'10564'),('MEM',58481,'4187786'),('MEM',5201,'230275712'),('MEM',39296,'886'),('MASK',0,'1000100X010X11101X1011011X0110X11XXX'),('MEM',38587,'50240362'),('MEM',42581,'116256847'),('MEM',37181,'4441034'),('MEM',16281,'23027479'),('MEM',32451,'71649158'),('MEM',33316,'6511'),('MASK',0,'000001X11101111011X1X10X1X001X1X1000'),('MEM',26168,'390'),('MEM',11548,'29301'),('MEM',2731,'3188615'),('MASK',0,'1100XX00X0X110001X111X000011X0X10001'),('MEM',32136,'6436'),('MEM',46206,'225594'),('MEM',33132,'7862942'),('MEM',15264,'198'),('MASK',0,'01001001000X1101000111011X0011XXX10X'),('MEM',33733,'14993993'),('MEM',9905,'246637292'),('MEM',6373,'2090'),('MEM',53539,'29386'),('MASK',0,'0X1010X1X01011XX11111100100XX110X00X'),('MEM',41520,'452041'),('MEM',8605,'43647'),('MEM',62764,'3241680'),('MASK',0,'0X1X10X1010111X0X1110XXX00000110X001'),('MEM',38517,'3338'),('MEM',52745,'4455'),('MEM',33218,'850605'),('MEM',20495,'315451'),('MASK',0,'0XX0X001010X11X01X111X1101X11X101000'),('MEM',32284,'615642818'),('MEM',62844,'46924'),('MEM',31120,'146622'),('MEM',21925,'518931'),('MEM',29515,'1112'),('MEM',31241,'130404'),('MEM',9905,'5469165'),('MASK',0,'01101000001X110X1101101110XX1X1XX101'),('MEM',46432,'346428972'),('MEM',64522,'218092103'),('MEM',42311,'2316477'),('MEM',20060,'565'),('MEM',62919,'261004'),('MEM',50103,'42134'),('MASK',0,'0101100101000100X1X01XX11X0X00111010'),('MEM',41199,'48367827'),('MEM',40992,'886149'),('MEM',19927,'93429'),('MASK',0,'01001X01X0XX110X0XX1110X011110001101'),('MEM',40019,'187824261'),('MEM',3416,'35491'),('MEM',51276,'173825792'),('MASK',0,'X100100110001X000X11010X00001010X001'),('MEM',21071,'3775434'),('MEM',41466,'601899'),('MEM',29191,'163888869'),('MEM',64981,'1094832'),('MEM',36745,'7560'),('MEM',44434,'3179'),('MEM',5040,'16142'),('MASK',0,'0X101X011XX011111111010100010X0X01X0'),('MEM',44140,'22478'),('MEM',26863,'31310307'),('MEM',56680,'131716'),('MEM',3983,'22050'),('MASK',0,'1X0X10010X011X1X101X1000X1100X000010'),('MEM',45724,'5130'),('MEM',38747,'147724'),('MEM',39515,'58764331'),('MASK',0,'0X001101X10000010X1X00010XX001010101'),('MEM',50201,'65493'),('MEM',44879,'7688011'),('MEM',29782,'85876639'),('MEM',63157,'57556'),('MASK',0,'00X00001010111X010X1X01X0101X01010XX'),('MEM',37667,'539'),('MEM',65058,'928398'),('MEM',16037,'2162946'),('MASK',0,'X010100000X11X001111001011011001XX11'),('MEM',20601,'689238135'),('MEM',62832,'22132331'),('MEM',20030,'421255'),('MEM',38454,'4898563'),('MASK',0,'01101XX0000111X001111100011000X01111'),('MEM',40968,'287372'),('MEM',32860,'121630361'),('MEM',6956,'54910'),('MASK',0,'01101001100X11X0010X0101101010001X11'),('MEM',52270,'852273185'),('MEM',44434,'5773'),('MEM',40591,'363113'),('MEM',31075,'550'),('MEM',1148,'237482'),('MASK',0,'0110100000001100X111X111111010X00X10'),('MEM',9807,'919'),('MEM',10050,'284353'),('MEM',11553,'99307'),('MASK',0,'11X1X0X0010001000101100X1XX10X100X10'),('MEM',51707,'59769'),('MEM',17916,'456671254'),('MEM',15968,'74716184'),('MEM',61681,'11534'),('MASK',0,'0X0010010000110X01X1X111X001X111100X'),('MEM',63572,'19584'),('MEM',12382,'54348210'),('MEM',7204,'62681'),('MEM',58309,'718'),('MASK',0,'XX0X0X11X0XX1100X10110111101X1000101'),('MEM',19172,'49321'),('MEM',3972,'156574486'),('MEM',53411,'371993'),('MEM',34118,'1245490'),('MEM',63786,'28834'),('MEM',44434,'1679'),('MASK',0,'0X010XX1101111001101110X1X0X1X1000X0'),('MEM',65433,'41829624'),('MEM',5383,'3874764'),('MEM',58309,'40586'),('MEM',34516,'1861'),('MASK',0,'0X00100X000X1100111X0011100010011100'),('MEM',30691,'6349'),('MEM',26045,'2259746'),('MEM',35285,'2525303'),('MEM',56918,'64290918'),('MEM',34521,'495146'),('MEM',41173,'1892852'),('MEM',62708,'2610505'),('MASK',0,'X1001000010XX10001011X10101000011000'),('MEM',41877,'606935473'),('MEM',10746,'30201'),('MEM',7236,'2402617'),('MEM',31075,'394149597'),('MEM',62893,'2808512'),('MEM',44723,'5738170'),('MEM',61147,'2124552'),('MASK',0,'01X0100X0X0X1100X1111X11X00X01X01001'),('MEM',9905,'376'),('MEM',56967,'457904468'),('MEM',55040,'2448'),('MEM',65513,'2222'),('MEM',25340,'23079'),('MEM',39876,'4874'),('MEM',38909,'16667453'),('MASK',0,'X0001X0X01011110101X10XX1X1X10X01100'),('MEM',19488,'3061762'),('MEM',26132,'292794'),('MASK',0,'010010X101X01001001110X000X1011X11X0'),('MEM',1980,'12162025'),('MEM',37165,'15333747'),('MEM',39210,'152686'),('MASK',0,'01X010X0010XX100011110000X000XX00101'),('MEM',27917,'944976'),('MEM',25099,'11114'),('MEM',7777,'577171'),('MEM',27080,'16334871'),('MEM',14285,'531'),('MASK',0,'X1X0100001X01100X10X1111100X00111010'),('MEM',28216,'2511'),('MEM',37165,'7141'),('MEM',55924,'439753'),('MEM',11901,'464'),('MEM',38571,'407'),('MEM',782,'10823'),('MASK',0,'0XX00X01010111XX11111110XX010010000X'),('MEM',54749,'360481'),('MEM',20495,'5280'),('MEM',37684,'6039'),('MEM',6345,'2073116'),('MEM',63110,'22301539'),('MASK',0,'X0X1010110111100110X1001100X1X100100'),('MEM',20722,'9600365'),('MEM',19084,'76987'),('MEM',23777,'740859'),('MASK',0,'001X000111X01X000X11X000110111101100'),('MEM',27917,'52797296'),('MEM',57636,'322'),('MEM',11553,'70582'),('MEM',8605,'30966411'),('MEM',25394,'812862'),('MEM',48296,'317'),('MEM',60466,'1411129'),('MASK',0,'X110000X0XXX11101111001X100110100000'),('MEM',33339,'4981'),('MEM',40073,'5710720'),('MEM',33814,'13208'),('MEM',14664,'1950645'),('MEM',35042,'35994943'),('MASK',0,'10101000X0X1X0XXX1X1101011001100000X'),('MEM',61417,'114327'),('MEM',26863,'706549'),('MEM',5651,'118955'),('MASK',0,'011X10000010110111X10111X1001100101X'),('MEM',7679,'272716'),('MEM',24077,'12277996'),('MASK',0,'X11XX000010001X00X011X1111X001XX0000'),('MEM',46531,'35092779'),('MEM',1116,'11777757'),('MEM',5932,'519743'),('MEM',36187,'318'),('MEM',38758,'718897339'),('MASK',0,'01001X0110001000X0010X010010X01000X0'),('MEM',31101,'257'),('MEM',39813,'30972074'),('MEM',23252,'1761211'),('MASK',0,'0X10100X00X0110X1111X1111010X1001101'),('MEM',17132,'2823025'),('MEM',62368,'442239906'),('MEM',24553,'339245'),('MEM',64751,'66303'),('MEM',56967,'870173'),('MEM',15383,'342572184'),('MEM',1647,'20517'),('MASK',0,'00001XX000X11X0011X110X110XX1X010101'),('MEM',16037,'1478'),('MEM',33316,'30615219'),('MEM',6729,'209640491'),('MASK',0,'01001000X1X1X100X1110100000X1X011X01'),('MEM',62368,'29355190'),('MEM',48784,'1522851'),('MEM',26590,'14698075'),('MASK',0,'0XX0X0011X00X0000X11011010011110X101'),('MEM',249,'746'),('MEM',11553,'236505210'),('MEM',38328,'823888'),('MEM',58433,'125568672'),('MASK',0,'X000X0000101X1101X10110X000X00111100'),('MEM',37813,'4058843'),('MEM',32745,'9417061'),('MASK',0,'000XX110001111X01XX1XX01X00111110100'),('MEM',22103,'2397'),('MEM',40229,'47978173'),('MEM',3477,'14703'),('MEM',8594,'2471'),('MEM',22603,'44648051'),('MEM',11340,'25471'),('MASK',0,'000001X1010111001X11X1X1100XX0101X0X'),('MEM',41160,'52'),('MEM',2907,'827'),('MEM',15719,'107392281'),('MEM',43537,'19084747'),('MEM',53742,'3326211'),('MEM',46206,'51870'),('MEM',30694,'6031208'),('MASK',0,'0X10100000011100111X11100010X1111X01'),('MEM',31885,'3110667'),('MEM',40041,'30422'),('MASK',0,'00XX0XX101X111XX11X10111001101001000'),('MEM',2874,'10110'),('MEM',21776,'28380745'),('MEM',32004,'7076'),('MEM',9644,'526'),('MASK',0,'011010110001X1000XX110X0X0110000X011'),('MEM',35281,'4670'),('MEM',7204,'115940579'),('MEM',58380,'17616'),('MEM',40735,'46877007'),('MEM',30986,'20371'),('MASK',0,'0XX01001010010X100111010110001111X10'),('MEM',43046,'2060276'),('MEM',20743,'553391345'),('MEM',20821,'3685352'),('MEM',43943,'39969'),('MASK',0,'0010100101010X0011XXX01XX100XXX11111'),('MEM',29261,'60453'),('MEM',63512,'94339357'),('MEM',34827,'18871625'),('MEM',52359,'322200'),('MEM',38003,'25491'),('MEM',24795,'461240689'),('MASK',0,'0000010X01011100101X010100X1X1101010'),('MEM',26894,'3512'),('MEM',1023,'9354'),('MASK',0,'11010XXX100011001101011X1111011001X1'),('MEM',45476,'4571'),('MEM',2838,'7601404'),('MEM',30540,'187'),('MASK',0,'X1X01X01X000110001011X010X0111X01001'),('MEM',32944,'381053'),('MEM',63110,'7479218'),('MEM',59783,'121082'),('MEM',56918,'1237706'),('MEM',32355,'472'),('MEM',44080,'131839645'),('MEM',56680,'38523')
DROP TABLE #HL_RESULT
CREATE TABLE #HL_RESULT(ID BIGINT,VAL  BIGINT)
CREATE TABLE #HL_COM(V BIGINT)
INSERT INTO #HL_RESULT (ID) SELECT TOP (70000) 1-1+ROW_NUMBER() OVER(ORDER BY T1.NUMBER) AS N FROM MASTER..SPT_VALUES T1  CROSS JOIN MASTER..SPT_VALUES T2

--#1 6559449933360
DECLARE @SUM BIGINT =0, @I INT = 1, @RESULT AS BIGINT=0,@BUS AS INT, @GRP INT, @CMD VARCHAR(4),@INST VARCHAR(100),@MASK VARCHAR(100),@VAL INT
WHILE (@I <= (SELECT COUNT(1) FROM #HL_TEMP))
BEGIN
  SELECT @SUM=0,@GRP=GRP,@CMD=CMD,@INST=INST,@VAL=VAL,  @MASK = CASE WHEN CMD='MASK' THEN INST ELSE @MASK END FROM #HL_TEMP WHERE ID=@I
    IF @CMD = 'mem' BEGIN
		 SELECT  @SUM=SUM(V) FROM 
		 (
			SELECT CASE WHEN SUBSTRING(@MASK,37-N,1) ='0' AND CAST(@INST AS INT)&POWER(CAST(2 AS BIGINT),N-1)=POWER(CAST(2 AS BIGINT),N-1) THEN -POWER(CAST(2 AS BIGINT),N-1) WHEN SUBSTRING(@MASK,37-N,1) ='1' AND CAST(@INST AS INT)&POWER(CAST(2 AS BIGINT),N-1)!=POWER(CAST(2 AS BIGINT),N-1) THEN POWER(CAST(2 AS BIGINT),N-1)   ELSE 0 END AS V  
	  		FROM (SELECT TOP 36 ROW_NUMBER() OVER(ORDER BY T1.NUMBER) AS N FROM MASTER..SPT_VALUES T1 ) T
		 ) G
		UPDATE #HL_RESULT SET VAL=CAST(@INST AS INT)+@SUM WHERE ID=@VAL		  
	END
	SET @I=@I+1
END
SELECT SUM(VAL) FROM #HL_RESULT WHERE VAL>0

--#¨2 3369767240513
TRUNCATE TABLE #HL_RESULT 
DECLARE @SUM BIGINT =0, @I INT = 1, @RESULT AS BIGINT=0,@BUS AS INT, @GRP INT, @CMD VARCHAR(4),@INST VARCHAR(100),@MASK VARCHAR(100),@VAL INT
WHILE (@I <= (SELECT COUNT(1) FROM #HL_TEMP))
BEGIN
	SELECT @SUM=0,@CMD=CMD,@INST=INST,@VAL=VAL, @MASK = CASE WHEN CMD='MASK' THEN INST ELSE @MASK END FROM #HL_TEMP WHERE ID=@I
	IF @CMD = 'mem' BEGIN 
		;WITH COMMANDS AS
		(
			SELECT N = CAST(1 AS BIGINT),CAST(0 AS BIGINT) AS VAL
			UNION ALL
			SELECT  N+1,C1.VAL+H1.V		
			FROM COMMANDS C1 INNER JOIN #HL_COM H1 ON (H1.V=0 OR H1.V=POWER(CAST(2 AS BIGINT),N-1) )
			WHERE N<37
		)
		MERGE #HL_RESULT AS TARGET
		USING (SELECT DISTINCT VAL FROM COMMANDS) AS SOURCE 
		ON (TARGET.ID = SOURCE.VAL+@VAL+@SUM) 
		WHEN MATCHED 
		THEN UPDATE SET TARGET.VAL = CAST(@INST AS INT) 
		WHEN NOT MATCHED BY TARGET 
		THEN INSERT (ID, VAL) VALUES (SOURCE.VAL+@VAL+@SUM, CAST(@INST AS INT));
	END
	ELSE BEGIN
		SELECT  @SUM=SUM(CASE WHEN SUBSTRING(@MASK,37-N,1) ='X' AND CAST(@VAL AS INT)&POWER(CAST(2 AS BIGINT),N-1)=POWER(CAST(2 AS BIGINT),N-1) THEN -POWER(CAST(2 AS BIGINT),N-1) WHEN SUBSTRING(@MASK,37-N,1) ='1' AND CAST(@VAL AS INT)&POWER(CAST(2 AS BIGINT),N-1)!=POWER(CAST(2 AS BIGINT),N-1) THEN POWER(CAST(2 AS BIGINT),N-1)   ELSE 0 END)  
	  	FROM (SELECT TOP 37 ROW_NUMBER() OVER(ORDER BY T1.NUMBER) AS N FROM MASTER..SPT_VALUES T1 ) T
		
		TRUNCATE TABLE #HL_COM
		INSERT INTO #HL_COM
		SELECT  CASE WHEN SUBSTRING(@MASK,37-N,1) ='X' THEN POWER(CAST(2 AS BIGINT),N-1) ELSE 0 END AS V 
		FROM (SELECT TOP 37 ROW_NUMBER() OVER(ORDER BY T1.NUMBER) AS N FROM MASTER..SPT_VALUES T1 ) T WHERE SUBSTRING(@MASK,37-N,1) ='X' OR N=37
	END
	SET @I=@I+1
END
SELECT SUM(VAL) FROM #HL_RESULT WHERE VAL>0

