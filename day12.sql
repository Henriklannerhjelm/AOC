--CREATE TABLE #hl_temp(id Int Identity(1, 1),dir varchar(100), val  int)
--INSERT INTO #HL_TEMP (dir,val) VALUES
--('N',1),('R',90),('S',5),('R',180),('N',3),('W',1),('L',180),('F',92),('R',270),('E',4),('F',4),('W',4),('W',4),('L',180),('S',2),('W',2),('F',90),('E',1),('S',5),('W',3),('F',78),('S',5),('R',180),('F',100),('N',1),('W',3),('L',90),('L',90),('N',1),('F',94),('W',2),('R',90),('F',49),('W',2),('F',26),('R',180),('W',1),('S',5),('R',180),('W',4),('S',3),('R',90),('W',3),('S',4),('E',5),('S',1),('F',13),('N',5),('R',270),('E',2),('R',270),('S',5),('F',3),('E',3),('F',4),('S',3),('R',270),('S',1),('W',4),('R',90),('S',4),('L',180),('N',4),('F',81),('W',2),('R',90),('F',61),('R',90),('F',13),('N',3),('R',180),('W',1),('F',98),('S',5),('F',50),('W',5),('S',3),('W',5),('R',90),('F',17),('S',5),('F',70),('F',7),('E',2),('F',87),('E',1),('L',270),('F',59),('E',2),('R',180),('N',5),('F',59),('L',90),('N',5),('W',5),('F',10),('N',3),('E',1),('R',90),('W',1),('S',2),('R',90),('N',5),('F',25),('R',90),('E',2),('F',57),('R',180),('E',1),('N',3),('W',2),('F',85),('L',90),('F',50),('W',2),('R',90),('S',3),('R',90),('F',27),('E',1),('S',1),('L',90),('F',32),('L',90),('W',3),('R',90),('E',1),('F',39),('S',5),('E',4),('F',50),('W',4),('L',90),('F',63),('N',2),('F',67),('W',3),('R',90),('F',4),('N',2),('R',90),('F',90),('N',5),('L',180),('F',24),('E',5),('N',3),('L',180),('F',67),('E',3),('L',90),('S',3),('F',49),('R',90),('E',5),('F',89),('W',5),('F',62),('F',39),('F',33),('W',1),('R',90),('F',18),('S',3),('R',90),('N',4),('F',47),('N',5),('N',3),('W',2),('S',5),('L',90),('E',4),('L',90),('W',2),('R',90),('W',5),('L',90),('W',5),('N',4),('F',64),('R',90),('S',2),('W',4),('R',90),('N',3),('F',18),('L',90),('S',4),('L',90),('F',31),('S',4),('L',90),('F',79),('R',90),('F',69),('N',3),('E',4),('F',64),('N',2),('E',4),('R',90),('F',20),('R',180),('E',1),('F',85),('W',1),('S',5),('S',2),('F',21),('R',90),('F',43),('N',1),('F',18),('S',5),('R',180),('F',52),('L',180),('W',4),('F',5),('L',90),('F',70),('S',4),('N',3),('R',180),('F',64),('R',90),('F',17),('R',90),('E',5),('F',85),('N',1),('F',74),('E',5),('F',21),('N',1),('F',35),('N',1),('F',65),('W',2),('F',67),('N',1),('E',5),('F',79),('S',4),('R',90),('F',20),('R',180),('W',5),('L',180),('S',4),('F',56),('S',4),('L',90),('E',5),('F',13),('S',5),('F',38),('W',1),('S',2),('L',90),('N',4),('E',3),('R',180),('W',3),('N',1),('R',90),('F',52),('N',5),('F',23),('E',5),('F',82),('E',5),('S',2),('E',3),('N',3),('S',2),('L',90),('N',1),('R',90),('S',5),('F',60),('W',1),('N',2),('W',1),('N',3),('E',4),('F',2),('E',2),('L',90),('S',1),('L',90),('E',4),('N',1),('R',180),('E',2),('R',180),('F',93),('F',94),('L',90),('S',4),('E',5),('R',90),('F',5),('S',2),('E',2),('S',3),('E',4),('R',180),('F',56),('E',2),('N',2),('F',3),('R',90),('W',2),('F',94),('W',5),('F',47),('L',180),('F',68),('E',5),('F',63),('S',3),('E',4),('F',93),('L',90),('S',5),('L',180),('W',5),('S',5),('W',3),('L',180),('F',34),('R',90),('F',87),('W',4),('S',1),('W',3),('R',270),('S',1),('E',1),('F',78),('E',4),('R',90),('F',91),('W',4),('S',3),('W',1),('F',41),('N',4),('E',1),('F',66),('S',1),('W',5),('F',62),('N',2),('W',2),('L',90),('W',1),('F',23),('L',270),('N',2),('W',2),('S',3),('F',9),('R',90),('F',2),('E',4),('F',61),('L',90),('W',5),('N',4),('F',97),('L',90),('F',93),('N',5),('L',270),('R',90),('W',1),('R',90),('R',90),('N',4),('E',1),('F',72),('N',4),('R',270),('F',24),('W',1),('F',79),('S',1),('E',3),('N',4),('E',3),('L',90),('W',2),('S',1),('R',270),('W',5),('F',24),('E',5),('S',4),('F',22),('L',180),('F',57),('S',5),('R',90),('N',4),('W',3),('F',18),('N',2),('R',90),('E',3),('F',55),('N',2),('R',90),('S',5),('F',4),('W',3),('L',90),('N',2),('W',3),('L',270),('E',4),('R',90),('F',46),('S',5),('N',1),('F',16),('N',1),('R',90),('F',8),('L',180),('N',2),('W',3),('N',4),('E',1),('S',3),('L',90),('F',4),('E',5),('N',5),('E',3),('R',90),('F',35),('N',2),('F',68),('F',33),('E',5),('F',38),('E',4),('F',27),('R',180),('S',5),('F',47),('R',90),('F',43),('R',90),('S',1),('F',84),('L',180),('F',47),('R',90),('N',4),('E',4),('F',77),('R',180),('N',1),('E',2),('S',4),('F',45),('S',1),('L',90),('E',5),('F',40),('L',90),('W',5),('F',25),('W',4),('R',90),('F',80),('N',5),('E',2),('F',74),('W',3),('N',3),('E',4),('F',48),('N',3),('R',90),('N',2),('W',1),('L',90),('S',2),('F',35),('L',90),('E',5),('R',180),('W',5),('N',2),('E',1),('L',90),('N',2),('F',78),('S',5),('R',270),('S',5),('R',90),('N',5),('E',3),('L',90),('S',5),('F',13),('S',5),('F',52),('L',90),('N',2),('R',180),('E',1),('F',41),('S',1),('F',20),('N',4),('F',34),('N',2),('F',45),('E',5),('L',90),('W',3),('L',270),('N',5),('F',52),('R',90),('N',5),('E',5),('N',2),('W',2),('W',5),('R',270),('W',5),('F',10),('N',3),('F',63),('N',4),('F',53),('L',90),('E',5),('L',270),('F',17),('N',1),('L',90),('F',26),('F',93),('R',90),('S',5),('R',270),('S',5),('R',180),('N',4),('F',58),('L',180),('F',40),('S',2),('F',54),('N',5),('F',70),('W',1),('N',4),('W',1),('L',90),('W',5),('R',90),('N',2),('R',90),('S',5),('F',95),('W',4),('L',180),('E',3),('F',68),('S',1),('F',56),('R',90),('W',1),('L',180),('F',66),('R',90),('S',2),('F',57),('L',90),('E',1),('F',42),('S',4),('F',44),('L',90),('F',42),('E',4),('R',90),('S',4),('W',5),('R',90),('E',4),('S',4),('E',5),('F',27),('R',90),('N',1),('R',90),('E',5),('R',90),('W',4),('S',1),('F',81),('N',5),('R',180),('S',4),('E',4),('F',68),('S',3),('L',90),('E',4),('E',4),('L',180),('E',3),('F',8),('W',2),('L',90),('S',4),('L',180),('N',2),('L',180),('E',1),('R',90),('W',5),('N',4),('W',4),('R',90),('F',1),('S',5),('E',2),('L',90),('F',49),('N',4),('W',3),('R',90),('E',5),('F',33),('R',180),('S',4),('E',5),('S',2),('F',79),('W',4),('F',38),('R',90),('F',1),('L',90),('F',56),('L',270),('N',2),('L',90),('E',2),('L',90),('F',25),('W',1),('S',4),('L',270),('W',3),('R',90),('N',2),('F',68),('E',1),('R',180),('W',3),('R',90),('W',3),('R',90),('S',3),('F',4),('W',3),('N',3),('R',90),('W',3),('N',1),('F',54),('W',2),('S',5),('E',4),('F',76),('F',47),('N',1),('F',32),('L',180),('L',90),('F',19),('N',2),('E',5),('L',90),('E',1),('L',90),('E',3),('R',90),('F',48),('R',270),('S',3),('R',180),('S',4),('F',53),('R',90),('F',90),('E',4),('F',100),('L',90),('F',49),('N',1),('W',1),('F',56),('E',2),('N',5),('L',90),('F',39),('R',90),('W',2),('F',26),('E',4),('N',4),('L',90),('F',9),('L',90),('F',41),('W',5),('N',4),('S',1),('W',4),('N',3),('R',90),('N',5),('L',270),('F',82),('L',90),('F',75),('S',5),('F',25),('S',4),('F',67),('N',4),('F',57),('E',4),('N',4),('F',73),('W',5),('L',90),('E',2),('R',180),('N',5),('L',270),('W',3),('F',95),('W',2),('S',4),('E',1),('R',180),('N',3),('W',2),('N',1),('F',28),('N',2),('R',90),('E',3),('S',1),('F',41),('E',4),('N',1),('R',90),('F',12),('L',90),('N',2),('S',2),('E',3),('F',31),('W',1),('L',90),('E',5),('S',1),('F',12),('R',180),('W',5),('R',90),('F',26)
--UPDATE  #HL_Temp set val=-val where dir IN('E','S')
---UPDATE #HL_TEMP SET val=360-val,dir='R' WHERE dir='L' 
--#1
;WITH Moves AS
(
    SELECT n = 1,-0 AS X,0 AS Y,-1 AS mx,0 as my
	FROM #hl_temp h1 where id=1
    UNION ALL
	SELECT  n+1,
			x+(h1.val*mx*PATINDEX('F',h1.dir))+PATINDEX('[E|W]',h1.dir)*h1.val,
			y+(h1.val*my*PATINDEX('F',h1.dir))+PATINDEX('[N|S]',h1.dir)*h1.val,
			CASE h1.dir+LTRIM(h1.val) WHEN 'R90' THEN -my WHEN 'R180' THEN -mx WHEN 'R270' THEN my ELSE mx END,
			CASE h1.dir+LTRIM(h1.val) WHEN 'R90' THEN mx WHEN 'R180' THEN -my WHEN 'R270' THEN -mx ELSE my END		
	FROM Moves INNER JOIN #hl_temp h1 on h1.id=n WHERE  n+1 <= 900
)
SELECT TOP 1 ABS(X)+abs(Y) FROM Moves ORDER BY N DESC OPTION (MAXRECURSION 900) --1631

--#2
;WITH Commands AS
(
    SELECT n = 1,0 AS X,0 AS Y,-10 AS mx,1 as my
	from #hl_temp h1 where id=1
    UNION ALL
	select  n+1,
			x+(h1.val*mx*PATINDEX('F',h1.dir)),
			y+(h1.val*my*PATINDEX('F',h1.dir)),
			PATINDEX('[E|W]',h1.dir)*h1.val+CASE h1.dir+LTRIM(h1.val) WHEN 'R180' THEN -mx WHEN 'R90' THEN -my WHEN 'R270' THEN my ELSE mx END,
			PATINDEX('[N|S]',h1.dir)*h1.val+CASE h1.dir+LTRIM(h1.val) WHEN 'R180' THEN -my WHEN 'R90' THEN mx WHEN 'R270' THEN -mx ELSE my END		
	from Commands INNER JOIN #hl_temp h1 on h1.id=n where  n+1 <= 900
)
select TOP 1 ABS(X)+abs(Y) from commands ORDER BY N DESC OPTION (MAXRECURSION 900) -- 58606




